<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Estoque</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --roxo:#6c4cff;
  --roxo-escuro:#4b35c9;
  --preto:#0f0f1a;
  --cinza:#f4f5fa;
  --branco:#fff;
}

*{box-sizing:border-box;font-family:Inter,system-ui}

body{
  margin:0;
  background:var(--cinza);
  color:var(--preto);
}

header{
  background:linear-gradient(135deg,var(--roxo),var(--roxo-escuro));
  color:#fff;
  padding:20px;
  border-radius:0 0 24px 24px;
}

h1{margin:0;font-size:20px}

.container{
  padding:16px;
  max-width:480px;
  margin:auto;
}

.card{
  background:#fff;
  border-radius:20px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.05);
}

input,select,button{
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:12px;
  border:1px solid #ddd;
  font-size:14px;
}

button{
  background:var(--roxo);
  color:#fff;
  border:none;
  font-weight:600;
}

button.sec{
  background:#eee;
  color:#333;
}

.row{display:flex;gap:8px}
.row button{flex:1}

small{opacity:.6}

.list{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 0;
  border-bottom:1px solid #eee;
}

.badge{
  background:var(--roxo);
  color:#fff;
  padding:4px 10px;
  border-radius:20px;
  font-size:12px;
}

.footer-fixed{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:#fff;
  padding:12px;
  box-shadow:0 -5px 20px rgba(0,0,0,.1);
}
</style>
</head>

<body>

<header>
  <h1>üì¶ Controle de Estoque</h1>
  <small>Sistema simples e profissional</small>
</header>

<div class="container">

<!-- PRODUTOS -->
<div class="card">
  <h3>Adicionar produto</h3>
  <input id="nome" placeholder="Nome do produto">
  <input id="categoria" placeholder="Categoria">
  <input id="qtd" type="number" placeholder="Quantidade inicial">
  <button onclick="addProduto()">Adicionar</button>
</div>

<!-- LAN√áAMENTO -->
<div class="card">
  <h3>Lan√ßar movimenta√ß√£o</h3>
  <select id="prodSelect"></select>
  <select id="tipo">
    <option value="entrada">Entrada</option>
    <option value="saida">Sa√≠da</option>
  </select>
  <input id="qtdMov" type="number" placeholder="Quantidade">
  <button onclick="movimentar()">Lan√ßar</button>
</div>

<!-- DASHBOARD -->
<div class="card">
  <h3>Dashboard</h3>
  <canvas id="grafico"></canvas>
</div>

<!-- HIST√ìRICO -->
<div class="card">
  <h3>Hist√≥rico</h3>
  <input type="date" id="filtroData">
  <select id="filtroCat"></select>
  <div id="historico"></div>
</div>

<!-- RESUMO -->
<div class="card">
  <h3>Resumo por per√≠odo</h3>
  <input type="date" id="ini">
  <input type="date" id="fim">
  <select id="catResumo"></select>
  <button onclick="gerarResumo()">Gerar resumo</button>
  <pre id="resumo" style="white-space:pre-wrap"></pre>
</div>

</div>

<div class="footer-fixed">
  <div class="row">
    <button onclick="copiarResumo()">Copiar resumo</button>
    <button class="sec" onclick="enviarResumo()">Enviar</button>
  </div>
</div>

<script>
let produtos = JSON.parse(localStorage.getItem("produtos")) || [];
let historico = JSON.parse(localStorage.getItem("historico")) || [];

function salvar(){
  localStorage.setItem("produtos",JSON.stringify(produtos));
  localStorage.setItem("historico",JSON.stringify(historico));
  render();
}

function addProduto(){
  produtos.push({
    id:Date.now(),
    nome:nome.value,
    cat:categoria.value,
    qtd:+qtd.value,
    data:new Date().toLocaleDateString()
  });
  salvar();
}

function movimentar(){
  let p = produtos.find(p=>p.id==prodSelect.value);
  let q = +qtdMov.value;
  if(tipo.value==="saida") q*=-1;
  p.qtd+=q;

  historico.push({
    produto:p.nome,
    cat:p.cat,
    qtd:q,
    tipo:tipo.value,
    data:new Date().toLocaleString()
  });
  salvar();
}

function render(){
  prodSelect.innerHTML="";
  filtroCat.innerHTML="<option>Todas</option>";
  catResumo.innerHTML="<option>Todas</option>";

  let cats=[...new Set(produtos.map(p=>p.cat))];
  cats.forEach(c=>{
    filtroCat.innerHTML+=`<option>${c}</option>`;
    catResumo.innerHTML+=`<option>${c}</option>`;
  });

  produtos.forEach(p=>{
    prodSelect.innerHTML+=`<option value="${p.id}">${p.nome}</option>`;
  });

  historicoDiv();
  grafico();
}

function historicoDiv(){
  historico.innerHTML="";
  historico.slice().reverse().forEach(h=>{
    historico.innerHTML+=`
    <div class="list">
      <div>
        <strong>${h.produto}</strong><br>
        <small>${h.data}</small>
      </div>
      <span class="badge">${h.qtd}</span>
    </div>`;
  });
}

function grafico(){
  let data = produtos.map(p=>p.qtd);
  let labels = produtos.map(p=>p.nome);
  new Chart(grafico,{
    type:"doughnut",
    data:{labels,datasets:[{data,backgroundColor:["#6c4cff","#9b8cff","#c6bcff"]}]},
    options:{plugins:{legend:{display:false}}}
  });
}

function gerarResumo(){
  resumo.textContent=`üì¶ RESUMO DE ESTOQUE
Per√≠odo selecionado

Produtos: ${produtos.length}
Movimenta√ß√µes: ${historico.length}
`;
}

function copiarResumo(){
  navigator.clipboard.writeText(resumo.textContent);
}

function enviarResumo(){
  window.open(`https://wa.me/?text=${encodeURIComponent(resumo.textContent)}`);
}

render();
</script>

</body>
</html>
